# .pre-commit-config.yaml
# All hooks use 'local' repo to avoid GitHub dependencies

repos:
  - repo: local
    hooks:
      # General file checks
      - id: check-yaml
        name: Check YAML
        entry: python -c 'import sys, yaml; [yaml.safe_load(open(f)) for f in sys.argv[1:]]'
        language: system
        files: \.(yaml|yml)$

      - id: check-json
        name: Check JSON
        entry: python -c 'import sys, json; [json.load(open(f)) for f in sys.argv[1:]]'
        language: system
        files: \.json$

      - id: check-merge-conflict
        name: Check for Merge Conflicts
        entry: bash -c 'if grep -r "^<<<<<<< \|^=======$\|^>>>>>>> " "$@"; then echo "Merge conflict markers detected!"; exit 1; fi'
        language: system
        types: [text]

      - id: block-private-keys
        name:  Block Private Keys
        entry: >-
            bash -c '
              echo "Scanning for private keys... ";
              git diff --cached --name-only --diff-filter=ACMR |
                grep -vE "^(\.pre-commit-config\.yaml|\.secrets\.baseline|.git/)" |
                xargs -r grep -EiHn "(BEGIN [A-Z ]+ PRIVATE KEY|AKIA[0-9A-Z]{16}|ASIA[0-9A-Z]{16}|AWS_SECRET|password|token)" 2>/dev/null && {
                  echo "ERROR: Private key or credential found! (use .gitignore or env vars)";
                  exit 1;
                } || echo "No secrets detected";
              exit 0
            '
        language: system
        pass_filenames: true
        stages: [ pre-commit ]
        verbose: true

      - id: flake8
        name: flake8
        entry: flake8
        language: system
        types: [python]
        args: ['--max-line-length=200', '--extend-ignore=E203,W503']

      - id: black
        name: black
        entry: black
        language: system
        types: [ python ]
        args: [ '--line-length=150']

      # JavaScript/HTML linting
      - id: eslint
        name: eslint
        entry: eslint
        language: system
        files: \.(js|jsx)$
        types: [file]

      - id: validate-html
        name: Validate HTML
        entry: python -c 'import sys; from html.parser import HTMLParser; [HTMLParser().feed(open(f).read()) for f in sys.argv[1:]]'
        language: system
        files: \.html$

      # AWS/Lambda specific checks
      - id: check-aws-credentials
        name: Check for AWS credentials
        entry: bash -c 'if grep -r "AKIA\|aws_secret_access_key" --include="*.py" --include="*.js" .; then echo "AWS credentials detected!"; exit 1; fi'
        language: system
        pass_filenames: false
